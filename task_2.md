# Task 2: STIP Feature Clustering and BOF Descriptor Extraction

This project implements **Task 2**, which involves extracting spatiotemporal interest points (STIPs) from video files and clustering them into feature descriptors using **HoG** and **HoF**. The task is broken down into three sub-tasks:

- **Task 2a**: Sample STIPs from non-target videos, and apply K-means clustering to construct **HoG** and **HoF** cluster representatives for each of the 12 (sigma2, tau2) pairs.
  
- **Task 2b**: Extract a **Bag-of-Features (BOF)** descriptor based on **HoG** for a given video file.
  
- **Task 2c**: Extract a **Bag-of-Features (BOF)** descriptor based on **HoF** for a given video file.

## 1. Requirements

Ensure you have the following dependencies installed:

- **Python 3.7+**
- **NumPy** (for numerical operations)
- **SciKit-Learn** (for K-means clustering and NearestNeighbors)
- **OpenCV** (for video visualization)

You can install the required packages using the following command:

```bash
pip install numpy scikit-learn opencv-python
```

## 2. How to Run the Script

### 2.1. Command Line Arguments

The script accepts the following arguments:

- `--task`: Specifies which sub-task to run. Accepts values `2a`, `2b`, or `2c`.
- `--files`: (For Task 2a) Specifies the path to the main directory containing the STIP files (e.g., `hmdb51_org_stips`).
- `--video`: (For Task 2b and 2c) Specifies the path to the video file.
- `--stip`: (For Task 2b and 2c) Specifies the path to the corresponding STIP file.

### 2.2. Running the Script

Save the file as `task_2.py` and use the following commands to run each sub-task:

#### Task 2a: Construct HoG and HoF Cluster Representatives

This task involves sampling STIPs from all `.txt` files within the `hmdb51_org_stips` folder and clustering them into 12 (sigma2, tau2) pairs, creating HoG and HoF cluster representatives.

```bash
python task_2.py --task 2a --files /path/to/hmdb51_org_stips
```

- **Explanation**: 
  - The folder `/path/to/hmdb51_org_stips` should contain subdirectories (e.g., `brush_hair`, `catch`) with `.txt` STIP files.
  - The script will iterate through all the `.txt` files in the subdirectories, sample STIPs, and apply K-means clustering.

#### Task 2b: Extract BOF-HOG-480 Descriptor

For a given video and its corresponding STIP file, this task extracts a **Bag-of-Features** descriptor based on the **HoG** features. The descriptor is 480-dimensional, constructed from histograms of STIP assignments to 40 cluster centers for each of the 12 (sigma2, tau2) pairs.

```bash
python task_2.py --task 2b --video /path/to/video.avi --stip /path/to/stip_file.txt
```

```bash
python task_2.py --task 2b --video /Users/apoorvagarwal/Desktop/project/cse-515-phase1/non_target_videos/brush_hair/April_09_brush_hair_u_nm_np1_ba_goo_0.avi --stip /Users/apoorvagarwal/Desktop/project/cse-515-phase1/hmdb51_org_stips/brush_hair/April_09_brush_hair_u_nm_np1_ba_goo_0.avi.txt
```


```bash
python task_2.py --task 2c --video /Users/apoorvagarwal/Desktop/project/cse-515-phase1/non_target_videos/brush_hair/April_09_brush_hair_u_nm_np1_ba_goo_0.avi --stip /Users/apoorvagarwal/Desktop/project/cse-515-phase1/hmdb51_org_stips/brush_hair/April_09_brush_hair_u_nm_np1_ba_goo_0.avi.txt
```


- **Explanation**:
  - The script will load the video, visualize it, and extract a BOF-HOG-480 descriptor based on the STIP data in the provided `.txt` file.
  - The output will be a 480-dimensional feature vector based on HoG descriptors.

#### Task 2c: Extract BOF-HOF-480 Descriptor

For a given video and its corresponding STIP file, this task extracts a **Bag-of-Features** descriptor based on the **HoF** features. Similar to Task 2b, it constructs a 480-dimensional feature vector from histograms of STIP assignments to 40 cluster centers for each of the 12 (sigma2, tau2) pairs.

```bash
python task_2.py --task 2c --video /path/to/video.avi --stip /path/to/stip_file.txt
```

- **Explanation**:
  - The script will load the video, visualize it, and extract a BOF-HOF-480 descriptor based on the STIP data in the provided `.txt` file.
  - The output will be a 480-dimensional feature vector based on HoF descriptors.

### 2.3. Expected Output

#### Task 2a:
- The script will create and save cluster centers for **HoG** and **HoF** descriptors in the `cluster_centers/` directory, with files named based on the `(sigma2, tau2)` pairs, such as `hog_centers_sigma4_tau2.npy`.

#### Task 2b and 2c:
- The script will print the **480-dimensional** BOF descriptors for **HoG** and **HoF**, respectively.
  - Example output for Task 2b:
    ```bash
    BOF-HOG-480 Descriptor:
    [0. 1. 0. ... 0. 2. 0.]
    ```

## 3. Directory Structure

```
.
├── task_2.py                  # Python script to run Task 2
├── cluster_centers/            # Directory to save cluster centers (generated by Task 2a)
├── hmdb51_org_stips/           # Directory containing STIP files
│   ├── brush_hair/
│   │   └── file1.txt
│   ├── catch/
│   │   └── file2.txt
│   └── ...                    # Additional folders with STIP files
```

## 4. Explanation of Key Concepts

1. **Why (sigma2, tau2) Pairs?**
   - The `(sigma2, tau2)` pairs represent different spatial and temporal scales at which STIPs are detected. Each pair captures a different level of detail in space and time, which is why clustering and BOF creation are done separately for each pair.

2. **Why K-means Clustering?**
   - K-means is used to group the HoG and HoF descriptors into 40 clusters (visual words). These clusters represent common patterns in the data and are used to build histograms for each video.

3. **Why 400 STIPs?**
   - Selecting the 400 highest confidence STIPs ensures that we focus on the most relevant interest points. This reduces noise and improves the quality of the BOF descriptor.

4. **Bag-of-Features (BOF) Representation**:
  
